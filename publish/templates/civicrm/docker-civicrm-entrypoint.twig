#!/bin/bash
set -e

XDEBUG_CLIENT=""

# Check if docker host available 
if getent hosts host.docker.internal > /dev/null
then
  XDEBUG_CLIENT="host.docker.internal"
else 
	# use gateway
	XDEBUG_CLIENT=`/sbin/ip route|awk '/default/ { print $3 }'`
fi

cat << EOF > /usr/local/etc/php/conf.d/99-debug-host.ini
xdebug.client_host=${XDEBUG_CLIENT}
EOF

# first arg is `-f` or `--some-option`
if [ "${1#-}" != "$1" ]; then
	set -- apache2-foreground "$@"
fi

exec "$@"
